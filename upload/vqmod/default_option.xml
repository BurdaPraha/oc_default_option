<modification>
    <id>Option selected by default</id>
    <version>0.0.1</version>
    <vqmver>2.1.5</vqmver>
    <author>Michal Landsman</author>

    <file name="admin/model/catalog/product.php">
        <!-- edit model method "public function getProductOptions($product_id)" -->
        <operation>
            <search position="after"><![CDATA['weight_prefix'           => $product_option_value['weight_prefix']]]></search>
            <add><![CDATA[,'is_default'               => $product_option_value['is_default']]]></add>
        </operation>

        <!-- edit model method "public function addProduct($data)" and "public function editProduct($product_id, $data)" -->
        <operation>
            <search position="replace"><![CDATA[weight_prefix = '" . $this->db->escape($product_option_value['weight_prefix']) . "']]></search>
            <add><![CDATA[weight_prefix = '" . $this->db->escape($product_option_value['weight_prefix']) . "', is_default = '" . $this->db->escape(isset($product_option_value['is_default']) ? $product_option_value['is_default'] : 0) . "']]></add>
        </operation>
    </file>

    <!-- improve controller method "protected function getForm()" -->
    <file name="admin/controller/catalog/product.php">
        <operation>
            <search position="after"><![CDATA['weight_prefix'           => $product_option_value['weight_prefix']]]></search>
            <add><![CDATA[,'is_default'               => $product_option_value['is_default']]]></add>
        </operation>
    </file>

    <!-- improve option form template -->
    <file name="admin/view/template/catalog/product_form.tpl">

        <!-- add heading column -->
        <operation>
            <search position="after"><![CDATA[<td class="text-right"><?php echo $entry_weight; ?></td>]]></search>
            <add><![CDATA[<td class="text-right">Default</td>]]></add>
        </operation>

        <!-- improve javascript heading template -->
        <operation>
            <search position="after"><![CDATA[html += '        <td class="text-right"><?php echo $entry_weight; ?></td>';]]></search>
            <add><![CDATA[html += '        <td class="text-right">Default</td>';]]></add>
        </operation>

        <!-- add column with checkbox -->
        <operation>
            <search position="before"><![CDATA[<td class="text-left"><button type="button" onclick="$(this).tooltip('destroy');$('#option-value-row<?php echo $option_value_row; ?>').remove();" data-toggle="tooltip" title="<?php echo $button_remove; ?>" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>]]></search>
            <add><![CDATA[

            <td class="text-center">
                <div class="checkbox">
                    <label style="display: block">
                        <input type="checkbox" name="product_option[<?php echo $option_row; ?>][product_option_value][<?php echo $option_value_row; ?>][is_default]" value="1" value="1" <?php echo ('1' == $product_option_value['is_default'] ? 'checked="checked' : ''); ?> onclick="SetSel(this);" />
                    </label>
                </div>
            </td>

            ]]></add>
        </operation>

        <!-- improve javascript body template -->
        <operation>
            <search position="before"><![CDATA[html += '  <td class="text-left"><button type="button" onclick="$(this).tooltip(\'destroy\');$(\'#option-value-row' + option_value_row + '\').remove();" data-toggle="tooltip" rel="tooltip" title="<?php echo $button_remove; ?>" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';]]></search>
            <add><![CDATA[

            html += '<td class="text-center">';
                html += '<div class="checkbox">';
                    html += '<label>';
                        html += '<input type="checkbox" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][is_default]" value="1" value="1" onclick="SetSel(this);" />';
                    html += '</label>';
                html += '</div>';
            html += '</td>';

            ]]></add>
        </operation>

        <!-- change footer -->
        <operation>
            <search position="replace"><![CDATA[<td colspan="6"></td>]]></search>
            <add><![CDATA[<td colspan="7"></td>]]></add>
        </operation>

        <!-- add javascript function aka radio -->
        <operation>
            <search position="after"><![CDATA[<script type="text/javascript"><!--]]></search>
            <add><![CDATA[

            function SetSel(elem)
            {
              var elems = document.getElementsByTagName("input");
              var currentState = elem.checked;
              var elemsLength = elems.length;

              for(i=0; i<elemsLength; i++)
              {
                if(elems[i].type === "checkbox")
                {
                   elems[i].checked = false;
                }
              }

              elem.checked = currentState;
            }


            ]]></add>
        </operation>
    </file>

</modification>